public void testMetaData() throws Exception {
    ServiceDiscovery<Map> sDiscovery = getServiceDiscovery();
    assertNull(sDiscovery.queryForInstance("servers", ZK_ID));
    DummyUser du = new DummyUser();
    try {
        du.register();
        assertNotNull(sDiscovery.queryForInstance("servers", ZK_ID));
        List<ServiceInstance<Map>> allMetaData = du.getZKUtils().getAllMetaData();
        assertEquals(1, allMetaData.size());
        ServiceInstance<Map> meta = allMetaData.get(0);
        assertEquals(ZK_ID, meta.getId());
        assertEquals("servers", meta.getName());
        Map<String, String> data = meta.getPayload();
        assertEquals(2, data.size());
        assertEquals(ZK_ID, data.get("OOZIE_ID"));
        String url = ConfigUtils.getOozieURL(false);
        assertEquals(url, data.get("OOZIE_URL"));
    } finally {
        du.unregister();
    }
}

public void testOnSLADurationMissEvent() throws Exception {
    JMSSLAEventListener slaListener = new JMSSLAEventListener();
    slaListener.init(conf);
    String id = "0000000-000000000000001-oozie-wrkf-C@1";
    SLACalcStatus durationMiss = _createSLACalcStatus(id);
    SLARegistrationBean durationMissBean = durationMiss.getSLARegistrationBean();
    Date expectedStartDate = DateUtils.parseDateUTC("2013-01-01T00:00Z");
    Date actualStartDate = DateUtils.parseDateUTC("2013-01-01T01:00Z");
    Date expectedEndDate = DateUtils.parseDateUTC("2013-01-01T12:00Z");
    Date actualEndDate = DateUtils.parseDateUTC("2013-01-01T14:00Z");
    long expectedDuration = (expectedEndDate.getTime() - actualStartDate.getTime()) / (1000 * 60);
    durationMiss.setId(id);
    durationMissBean.setParentId("0000000-000000000000001-oozie-wrkf-C");
    durationMissBean.setAppName("Test-SLA-Duration-Miss");
    durationMiss.setEventStatus(EventStatus.DURATION_MISS);
    durationMiss.setSLAStatus(SLAStatus.IN_PROCESS);
    durationMissBean.setAppType(AppType.COORDINATOR_ACTION);
    durationMissBean.setUser("dummyuser");
    durationMissBean.setNotificationMsg("notification of duration miss");
    durationMissBean.setExpectedStart(expectedStartDate);
    durationMiss.setActualStart(actualStartDate);
    durationMissBean.setExpectedEnd(expectedEndDate);
    durationMiss.setActualEnd(actualEndDate);
    durationMissBean.setExpectedDuration(expectedDuration);
    long actualDuration = actualEndDate.getTime() - actualStartDate.getTime();
    durationMiss.setActualDuration(actualDuration);
    ConnectionContext jmsContext = getConnectionContext();
    Session session = jmsContext.createSession(Session.AUTO_ACKNOWLEDGE);
    MessageConsumer consumer = jmsContext.createConsumer(session, slaListener.getTopic(durationMiss));
    slaListener.onDurationMiss(durationMiss);
    TextMessage message = (TextMessage) consumer.receive(5000);
    SLAMessage durationMissMsg = (SLAMessage) JMSMessagingUtils.getEventMessage(message);
    // check msg header
    assertEquals(EventStatus.DURATION_MISS, durationMissMsg.getEventStatus());
    assertEquals(SLAStatus.IN_PROCESS, durationMissMsg.getSLAStatus());
    assertEquals(AppType.COORDINATOR_ACTION, durationMissMsg.getAppType());
    assertEquals(MessageType.SLA, durationMissMsg.getMessageType());
    assertEquals("Test-SLA-Duration-Miss", durationMissMsg.getAppName());
    assertEquals("dummyuser", durationMissMsg.getUser());
    // check msg body
    assertEquals("0000000-000000000000001-oozie-wrkf-C@1", durationMissMsg.getId());
    assertEquals("0000000-000000000000001-oozie-wrkf-C", durationMissMsg.getParentId());
    assertEquals(expectedStartDate, durationMissMsg.getExpectedStartTime());
    assertEquals(actualStartDate, durationMissMsg.getActualStartTime());
    assertEquals(expectedEndDate, durationMissMsg.getExpectedEndTime());
    assertEquals(actualEndDate, durationMissMsg.getActualEndTime());
    assertEquals(expectedDuration, durationMissMsg.getExpectedDuration());
    assertEquals(actualDuration, durationMissMsg.getActualDuration());
    assertEquals("notification of duration miss", durationMissMsg.getNotificationMessage());
}

public void testCoordCreateNotifyParentFailed() throws Exception {
    final BundleActionBean bundleAction;
    final BundleJobBean bundle;
    bundle = addRecordToBundleJobTable(Job.Status.RUNNING, false);
    bundleAction = addRecordToBundleActionTable(bundle.getId(), "coord1", 1, Job.Status.PREP);
    CoordinatorJobBean coordJob = addRecordToCoordJobTable(CoordinatorJob.Status.PREP, new Date(), new Date(), false, false, 1);
    coordJob.setBundleId(bundle.getId());
    coordJob.setAppName("coord1");
    CoordJobQueryExecutor.getInstance().executeUpdate(CoordJobQuery.UPDATE_COORD_JOB, coordJob);
    assertNull(bundleAction.getCoordId());
    sleep(3000);
    Runnable recoveryRunnable = new RecoveryRunnable(0, 1, 1);
    recoveryRunnable.run();
    waitFor(10000, new Predicate() {

        public boolean evaluate() throws Exception {
            BundleActionBean mybundleAction = BundleActionQueryExecutor.getInstance().get(BundleActionQuery.GET_BUNDLE_ACTION, bundle.getId() + "_coord1");
            return mybundleAction.getCoordId() != null;
        }
    });
    BundleActionBean mybundleAction = BundleActionQueryExecutor.getInstance().get(BundleActionQuery.GET_BUNDLE_ACTION, bundle.getId() + "_coord1");
    assertNotNull(mybundleAction.getCoordId());
}

/**
 * Test : The workflow should get purged, but the coordinator parent shouldn't get purged -->
 * the workflow and corresponding coord actions will get purged after we turn the purge.old.coord.action on
 * Coordinator itself will not be purged
 *
 * @throws Exception if cannot insert records to the database
 */
public void testUnpurgeableCoordinatorPurgeableWorkflowWithPurgeOldCoordActionTurnedOn() throws Exception {
    CoordinatorJobBean coordJob = addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING, false, false);
    WorkflowJobBean wfJob = addRecordToWfJobTable(WorkflowJob.Status.SUCCEEDED, WorkflowInstance.Status.SUCCEEDED);
    WorkflowActionBean wfAction = addRecordToWfActionTable(wfJob.getId(), "1", WorkflowAction.Status.OK);
    CoordinatorActionBean coordAction = addRecordToCoordActionTable(coordJob.getId(), 1, CoordinatorAction.Status.SUCCEEDED, "coord-action-get.xml", wfJob.getId(), "SUCCEEDED", 0);
    purgeWithSpecialParametersAndAlsoPurgeCoordActions(coordJob);
    assertCoordinatorJobNotPurged(coordJob);
    assertCoordinatorActionPurged(coordAction);
    assertWorkflowJobPurged(wfJob);
    assertWorkflowActionPurged(wfAction);
}

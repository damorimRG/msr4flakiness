/**
 * Test that env variable can contain '=' symbol within value
 *
 * @throws Exception
 */
public void testEnvVar() throws Exception {
    Services.get().destroy();
    Services services = new Services();
    services.getConf().setInt(LauncherAMUtils.CONF_OOZIE_ACTION_MAX_OUTPUT_DATA, 8 * 1042);
    services.init();
    FileSystem fs = getFileSystem();
    // Create the script file with canned shell command
    Path script = new Path(getAppPath(), SHELL_SCRIPTNAME);
    Writer w = new OutputStreamWriter(fs.create(script), StandardCharsets.UTF_8);
    w.write(SHELL_SCRIPT_CONTENT_ENVVAR);
    w.close();
    String envValueHavingEqualSign = "a=b;c=d";
    // Create sample shell action xml
    String actionXml = "<shell>" + "<job-tracker>" + getJobTrackerUri() + "</job-tracker>" + "<name-node>" + getNameNodeUri() + "</name-node>" + "<exec>" + SHELL_EXEC + "</exec>" + "<argument>" + SHELL_PARAM + "</argument>" + "<argument>" + SHELL_SCRIPTNAME + "</argument>" + "<argument>A</argument>" + "<argument>B</argument>" + "<env-var>var1=val1</env-var>" + "<env-var>var2=" + envValueHavingEqualSign + "</env-var>" + "<file>" + script.toString() + "#" + script.getName() + "</file>" + "<capture-output />" + "</shell>";
    Context context = createContext(actionXml);
    // Submit the action
    final String launcherId = submitAction(context);
    waitUntilYarnAppDoneAndAssertSuccess(launcherId);
    ShellActionExecutor ae = new ShellActionExecutor();
    WorkflowAction action = context.getAction();
    ae.check(context, action);
    ae.end(context, action);
    // Checking action data from shell script output
    assertEquals(envValueHavingEqualSign, PropertiesUtils.stringToProperties(action.getData()).getProperty("var2"));
}

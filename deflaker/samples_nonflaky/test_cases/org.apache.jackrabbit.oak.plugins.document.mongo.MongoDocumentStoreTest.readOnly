@Test
public void readOnly() throws Exception {
    // setup must have created nodes collection with index on _bin
    MongoCollection<?> mc = mongoConnection.getDatabase().getCollection(NODES.toString());
    assertTrue(hasIndex(mc, NodeDocument.HAS_BINARY_FLAG));
    mk.dispose();
    // remove the indexes
    mongoConnection = connectionFactory.getConnection();
    assertNotNull(mongoConnection);
    mc = mongoConnection.getDatabase().getCollection(NODES.toString());
    mc.dropIndexes();
    // must be gone now
    assertFalse(hasIndex(mc, NodeDocument.HAS_BINARY_FLAG));
    // start a new read-only DocumentNodeStore
    mk = newBuilder(mongoConnection.getMongoClient(), mongoConnection.getDBName()).setReadOnlyMode().open();
    // must still not exist when started in read-only mode
    assertFalse(hasIndex(mc, NodeDocument.HAS_BINARY_FLAG));
}

public void testLog4jReload() throws Exception {
    File log4jFile = new File(getTestCaseConfDir(), XLogService.DEFAULT_LOG4J_PROPERTIES);
    copyResourceToFile("test-oozie-log4j.properties", log4jFile);
    setSystemProperty(XLogService.LOG4J_RELOAD, "1");
    XLogService ls = new XLogService();
    ls.init(null);
    assertTrue("Trace should be enabled", LogFactory.getLog("a").isTraceEnabled());
    writeToFileTillLastModifiedChanges("test-custom-log4j.properties", log4jFile);
    float originalRatio = XTestCase.WAITFOR_RATIO;
    try {
        XTestCase.WAITFOR_RATIO = 1;
        waitFor(5 * 1000, new Predicate() {

            public boolean evaluate() throws Exception {
                return !LogFactory.getLog("a").isTraceEnabled();
            }
        });
        assertFalse("Trace should not be enabled", LogFactory.getLog("a").isTraceEnabled());
    } finally {
        XTestCase.WAITFOR_RATIO = originalRatio;
    }
    ls.destroy();
}

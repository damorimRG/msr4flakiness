public void testLockReentrant() throws ServiceException, InterruptedException {
    final String path = UUID.randomUUID().toString();
    MemoryLocksService lockService = new MemoryLocksService();
    try {
        lockService.init(Services.get());
        LockToken lock = lockService.getWriteLock(path, DEFAULT_LOCK_TIMEOUT);
        lock = (LockToken) lockService.getWriteLock(path, DEFAULT_LOCK_TIMEOUT);
        lock = (LockToken) lockService.getWriteLock(path, DEFAULT_LOCK_TIMEOUT);
        assertEquals(lockService.getMemoryLocks().size(), 1);
        lock.release();
        assertEquals(lockService.getMemoryLocks().size(), 1);
        lock.release();
        assertEquals(lockService.getMemoryLocks().size(), 1);
        lock.release();
        checkLockRelease(path, lockService);
    } catch (Exception e) {
        fail("Reentrant property, it should have acquired lock");
    } finally {
        lockService.destroy();
    }
}

/**
 * Test coord materialize job latency from Instrumentation, like mat_queue_size and mat_delayed_size
 * @throws Exception
 */
public void testCoordMaterializeTriggerService4() throws Exception {
    Date start = DateUtils.parseDateOozieTZ("2009-02-01T01:00Z");
    Date end = DateUtils.parseDateOozieTZ("2009-02-20T23:59Z");
    final CoordinatorJobBean job = addRecordToCoordJobTable(CoordinatorJob.Status.PREP, start, end, false, false, 0);
    waitForStatus(30000, job, CoordinatorJob.Status.PREP);
    Runnable runnable = new CoordMaterializeTriggerRunnable(3600, 300);
    runnable.run();
    waitForStatus(10000, job, CoordinatorJob.Status.RUNNING);
    MetricsInstrumentation instr = (MetricsInstrumentation) Services.get().get(InstrumentationService.class).get();
    String group = "coord_job_mat";
    String matQueueSizeKey = MetricRegistry.name(group, "mat_queue_size");
    String matDelayedSizeKey = MetricRegistry.name(group, "mat_delayed_size");
    SortedMap<String, Gauge> gaugeSortedMap = instr.getMetricRegistry().getGauges();
    assertNotNull("The metric of mat_queue_size should be not null, but not.", gaugeSortedMap.get(matQueueSizeKey));
    assertNotNull("The metric of mat_delayed_size should be not null, but not.", gaugeSortedMap.get(matDelayedSizeKey));
}

public void testWFXmlGeneration2() throws Exception {
    Configuration conf = new Configuration();
    conf.set(XOozieClient.RM, "jobtracker");
    conf.set(XOozieClient.NN, "namenode");
    conf.set(OozieClient.LIBPATH, "libpath");
    conf.set(XOozieClient.FILES, "/user/oozie/input1.txt,/user/oozie/input2.txt");
    conf.set(XOozieClient.ARCHIVES, "/user/oozie/udf1.jar,/user/oozie/udf2.jar");
    String[] args = new String[2];
    args[0] = "-a";
    args[1] = "aaa bbb";
    ActionUtils.setStrings(conf, XOozieClient.PIG_OPTIONS, args);
    SubmitPigXCommand submitPigCmd = new SubmitPigXCommand(conf);
    String xml = submitPigCmd.getWorkflowXml(conf);
    XLog.getLog(getClass()).info("xml = " + xml);
    StringBuilder sb = new StringBuilder();
    sb.append("<workflow-app xmlns=\"uri:oozie:workflow:0.2\" name=\"oozie-pig\">");
    sb.append("<start to=\"pig1\" />");
    sb.append("<action name=\"pig1\">");
    sb.append("<pig>");
    sb.append("<job-tracker>jobtracker</job-tracker>");
    sb.append("<name-node>namenode</name-node>");
    sb.append("<script>dummy.pig</script>");
    sb.append("<argument>-a</argument>");
    sb.append("<argument>aaa bbb</argument>");
    sb.append("<file>/user/oozie/input1.txt#input1.txt</file>");
    sb.append("<file>/user/oozie/input2.txt#input2.txt</file>");
    sb.append("<archive>/user/oozie/udf1.jar#udf1.jar</archive>");
    sb.append("<archive>/user/oozie/udf2.jar#udf2.jar</archive>");
    sb.append("</pig>");
    sb.append("<ok to=\"end\" />");
    sb.append("<error to=\"fail\" />");
    sb.append("</action>");
    sb.append("<kill name=\"fail\">");
    sb.append("<message>pig failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>");
    sb.append("</kill>");
    sb.append("<end name=\"end\" />");
    sb.append("</workflow-app>");
    Element root = XmlUtils.parseXml(sb.toString());
    String reference = XmlUtils.prettyPrint(root).toString();
    XLog.getLog(getClass()).info("reference xml = " + reference);
    assertTrue(xml.equals(reference));
}

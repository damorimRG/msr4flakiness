public void testValidateBundleNegative2() throws Exception {
    runTest("/v2/validate", V2ValidateServlet.class, IS_SECURITY_ENABLED, new Callable<Void>() {

        public Void call() throws Exception {
            Map<String, String> params = new HashMap<String, String>();
            params.put("file", "bundle.xml");
            params.put("user", getTestUser());
            URL url = createURL("", params);
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setRequestMethod("POST");
            conn.setRequestProperty("content-type", RestConstants.XML_CONTENT_TYPE);
            conn.setDoOutput(true);
            String xml = "<bundle-app-invalid name='test_bundle' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' " + "xmlns='uri:oozie:bundle:0.1'> " + "<controls> <kick-off-time>2009-02-02T00:00Z</kick-off-time> </controls> " + "<coordinator name='c12'> " + "<app-path>#app_path1</app-path>" + "<configuration> " + "<property> <name>START_TIME</name> <value>2009-02-01T00:00Z</value> </property> </configuration> " + "</coordinator></bundle-app-invalid>";
            writeXML(conn.getOutputStream(), xml);
            assertEquals(HttpServletResponse.SC_BAD_REQUEST, conn.getResponseCode());
            String error = conn.getHeaderField(RestConstants.OOZIE_ERROR_CODE);
            String message = conn.getHeaderField(RestConstants.OOZIE_ERROR_MESSAGE);
            assertEquals("E0701", error);
            assertEquals(true, message.matches("^.*cvc-elt.1(.a)?: " + "Cannot find the declaration of element 'bundle-app-invalid'.*$"));
            return null;
        }
    });
}

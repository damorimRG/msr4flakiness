@Test
public void isCollectionEmpty() {
    MongoConnection c = connectionFactory.getConnection();
    assertNotNull(c);
    c.getDatabase().drop();
    String collectionName = Collection.NODES.toString();
    MongoStatus status = new MongoStatus(c.getMongoClient(), c.getDBName());
    // consider empty when collection doesn't exist
    MongoCollection<BasicDBObject> nodes = c.getDatabase().getCollection(collectionName, BasicDBObject.class);
    assertTrue(MongoUtils.isCollectionEmpty(nodes, null));
    if (status.isClientSessionSupported()) {
        try (ClientSession s = c.getMongoClient().startSession()) {
            assertTrue(MongoUtils.isCollectionEmpty(nodes, s));
        }
    }
    // insert a document
    nodes.insertOne(new BasicDBObject("p", "v"));
    // check again
    assertFalse(MongoUtils.isCollectionEmpty(nodes, null));
    if (status.isClientSessionSupported()) {
        try (ClientSession s = c.getMongoClient().startSession()) {
            assertFalse(MongoUtils.isCollectionEmpty(nodes, s));
        }
    }
    // remove any document
    nodes.deleteMany(new BasicDBObject());
    // must be empty again
    assertTrue(MongoUtils.isCollectionEmpty(nodes, null));
    if (status.isClientSessionSupported()) {
        try (ClientSession s = c.getMongoClient().startSession()) {
            assertTrue(MongoUtils.isCollectionEmpty(nodes, s));
        }
    }
}

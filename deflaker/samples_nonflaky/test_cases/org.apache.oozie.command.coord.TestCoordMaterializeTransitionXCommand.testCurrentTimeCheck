public void testCurrentTimeCheck() throws Exception {
    long now = System.currentTimeMillis();
    // now
    Date startTime = DateUtils.toDate(new Timestamp(now));
    // 3 secondsFromHours from now
    Date endTime = DateUtils.toDate(new Timestamp(now + 3 * 60 * 60 * 1000));
    CoordinatorJobBean job = addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING, startTime, endTime, null, "5", 20);
    new CoordMaterializeTransitionXCommand(job.getId(), hoursToSeconds(1)).call();
    checkCoordJobs(job.getId(), CoordinatorJob.Status.RUNNING);
    job = CoordJobQueryExecutor.getInstance().get(CoordJobQuery.GET_COORD_JOB, job.getId());
    assertEquals(job.getLastActionNumber(), 12);
    new CoordMaterializeTransitionXCommand(job.getId(), hoursToSeconds(1)).call();
    // unfortunatily XCommand doesn't throw exception on precondition
    // assertEquals(e.getErrorCode(), ErrorCode.E1100);
    // assertTrue(e.getMessage().contains("Request is for future time. Lookup time is"));
    job = CoordJobQueryExecutor.getInstance().get(CoordJobQuery.GET_COORD_JOB, job.getId());
    // getLastActionNumber should 12, last CoordMaterializeTransitionXCommand have failed
    assertEquals(job.getLastActionNumber(), 12);
}

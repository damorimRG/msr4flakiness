public void testBundleStatusCoordSubmitFails() throws Exception {
    setSystemProperty(StatusTransitService.CONF_BACKWARD_SUPPORT_FOR_STATES_WITHOUT_ERROR, "false");
    BundleJobBean bundleJob = this.addRecordToBundleJobTable(Job.Status.RUNNING, false);
    final String bundleId = bundleJob.getId();
    addRecordToBundleActionTable(bundleId, null, 0, Job.Status.FAILED);
    Runnable runnable = new StatusTransitRunnable();
    runnable.run();
    // First try will kill the job.
    bundleJob = BundleJobQueryExecutor.getInstance().get(BundleJobQuery.GET_BUNDLE_JOB_STATUS, bundleId);
    assertEquals(Job.Status.FAILED, bundleJob.getStatus());
    bundleJob.setStatus(Job.Status.RUNNING);
    BundleJobQueryExecutor.getInstance().executeUpdate(BundleJobQuery.UPDATE_BUNDLE_JOB_STATUS_PENDING, bundleJob);
    runnable.run();
    // second try will change the status.
    bundleJob = BundleJobQueryExecutor.getInstance().get(BundleJobQuery.GET_BUNDLE_JOB_STATUS, bundleId);
    assertEquals(Job.Status.FAILED, bundleJob.getStatus());
}

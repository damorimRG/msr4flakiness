public void testCreateprotoConfWithMulipleLibPath() throws Exception {
    Services services = new Services();
    try {
        services.init();
        Reader reader = IOUtils.getResourceAsReader("wf-schema-valid.xml", -1);
        Writer writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "workflow.xml")), StandardCharsets.UTF_8);
        IOUtils.copyCharStream(reader, writer);
        createTestCaseSubDir("lib");
        writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "lib/maputil.jar")), StandardCharsets.UTF_8);
        writer.write("bla bla");
        writer.close();
        writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "lib/reduceutil.so")), StandardCharsets.UTF_8);
        writer.write("bla bla");
        writer.close();
        createTestCaseSubDir("libx");
        writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "libx/maputil_x.jar")), StandardCharsets.UTF_8);
        writer.write("bla bla");
        writer.close();
        createTestCaseSubDir("liby");
        writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "liby/maputil_y1.jar")), StandardCharsets.UTF_8);
        writer.write("bla bla");
        writer.close();
        writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "liby/maputil_y2.jar")), StandardCharsets.UTF_8);
        writer.write("bla bla");
        writer.close();
        createTestCaseSubDir("libz");
        writer = new OutputStreamWriter(new FileOutputStream(new File(getTestCaseDir(), "libz/maputil_z.jar")), StandardCharsets.UTF_8);
        writer.write("bla bla");
        writer.close();
        WorkflowAppService wps = Services.get().get(WorkflowAppService.class);
        Configuration jobConf = new XConfiguration();
        jobConf.set(OozieClient.APP_PATH, getTestCaseFileUri("workflow.xml"));
        jobConf.setStrings(OozieClient.LIBPATH, getTestCaseFileUri("libx"), getTestCaseFileUri("liby"), getTestCaseFileUri("libz"));
        jobConf.set(OozieClient.USER_NAME, getTestUser());
        Configuration protoConf = wps.createProtoActionConf(jobConf, true);
        assertEquals(getTestUser(), protoConf.get(OozieClient.USER_NAME));
        assertEquals(6, protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST).length);
        List<String> found = new ArrayList<String>();
        found.add(protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST)[0]);
        found.add(protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST)[1]);
        found.add(protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST)[2]);
        found.add(protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST)[3]);
        found.add(protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST)[4]);
        found.add(protoConf.getStrings(WorkflowAppService.APP_LIB_PATH_LIST)[5]);
        List<String> expected = new ArrayList<String>();
        expected.add(getTestCaseFileUri("lib/reduceutil.so"));
        expected.add(getTestCaseFileUri("lib/maputil.jar"));
        expected.add(getTestCaseFileUri("libx/maputil_x.jar"));
        expected.add(getTestCaseFileUri("liby/maputil_y1.jar"));
        expected.add(getTestCaseFileUri("liby/maputil_y2.jar"));
        expected.add(getTestCaseFileUri("libz/maputil_z.jar"));
        Collections.sort(expected);
        Collections.sort(found);
        assertEquals(expected.size(), found.size());
        for (int i = 0; i < expected.size(); i++) {
            assert (new URI(expected.get(i)).equals(new URI(found.get(i))));
        }
    } finally {
        services.destroy();
    }
}

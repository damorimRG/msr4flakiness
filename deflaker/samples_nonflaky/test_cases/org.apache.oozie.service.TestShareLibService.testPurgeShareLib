@Test
public void testPurgeShareLib() throws Exception {
    setShipLauncherInOozieConfig();
    FileSystem fs = getFileSystem();
    long expiryTime = System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(getOozieConfig().getInt(ShareLibService.LAUNCHERJAR_LIB_RETENTION, 7), TimeUnit.DAYS);
    // for directory created 8 days back to be deleted
    String expireTs = dt.format(new Date(expiryTime - TimeUnit.MILLISECONDS.convert(1, TimeUnit.DAYS)));
    // for directory created 6 days back NOT to be deleted
    String noexpireTs = dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(1, TimeUnit.DAYS)));
    // for directory created 5 days back NOT to be deleted
    String noexpireTs1 = dt.format(new Date(expiryTime + TimeUnit.MILLISECONDS.convert(2, TimeUnit.DAYS)));
    Path basePath = new Path(getOozieConfig().get(WorkflowAppService.SYSTEM_LIB_PATH));
    Path expirePath = new Path(basePath, ShareLibService.SHARE_LIB_PREFIX + expireTs);
    Path noexpirePath = new Path(basePath, ShareLibService.SHARE_LIB_PREFIX + noexpireTs);
    Path noexpirePath1 = new Path(basePath, ShareLibService.SHARE_LIB_PREFIX + noexpireTs1);
    createDirs(fs, expirePath, noexpirePath, noexpirePath1);
    services.init();
    assertEquals(4, fs.listStatus(basePath).length);
    assertTrue(fs.exists(noexpirePath));
    assertTrue(fs.exists(noexpirePath1));
    assertTrue(fs.exists(expirePath));
}

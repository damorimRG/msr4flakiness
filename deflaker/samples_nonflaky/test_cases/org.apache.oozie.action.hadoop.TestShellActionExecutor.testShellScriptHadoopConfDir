/**
 * Test if a shell script could run successfully with {@link ShellMain#CONF_OOZIE_SHELL_SETUP_HADOOP_CONF_DIR} enabled.
 *
 * @throws Exception
 */
public void testShellScriptHadoopConfDir() throws Exception {
    FileSystem fs = getFileSystem();
    // Create the script file with canned shell command
    Path script = new Path(getAppPath(), SHELL_SCRIPTNAME);
    Writer w = new OutputStreamWriter(fs.create(script), StandardCharsets.UTF_8);
    w.write(SHELL_SCRIPT_HADOOP_CONF_DIR_CONTENT);
    w.write(SHELL_SCRIPT_YARN_CONF_DIR_CONTENT);
    w.write(SHELL_SCRIPT_LOG4J_EXISTENCE_CHECKER);
    w.write(SHELL_SCRIPT_LOG4J_CONTENT_COUNTER);
    w.close();
    // Create sample Shell action xml
    String actionXml = "<shell>" + "<job-tracker>" + getJobTrackerUri() + "</job-tracker>" + "<name-node>" + getNameNodeUri() + "</name-node>" + "<configuration>" + "<property><name>oozie.action.shell.setup.hadoop.conf.dir</name><value>true</value></property>" + "</configuration>" + "<exec>" + SHELL_EXEC + "</exec>" + "<argument>" + SHELL_PARAM + "</argument>" + "<argument>" + SHELL_SCRIPTNAME + "</argument>" + "<file>" + script.toString() + "#" + script.getName() + "</file>" + "<capture-output/>" + "</shell>";
    // Submit and verify the job's status
    WorkflowAction action = _testSubmit(actionXml, true, "");
    String oozieActionConfXml = PropertiesUtils.stringToProperties(action.getData()).getProperty("OOZIE_ACTION_CONF_XML");
    String hadoopConfDir = PropertiesUtils.stringToProperties(action.getData()).getProperty("HADOOP_CONF_DIR");
    String yarnConfDir = PropertiesUtils.stringToProperties(action.getData()).getProperty("YARN_CONF_DIR");
    String log4jExists = PropertiesUtils.stringToProperties(action.getData()).getProperty("L4J_EXISTS");
    String log4jFileLineCount = PropertiesUtils.stringToProperties(action.getData()).getProperty("L4J_LC");
    String log4BadAppenderCount = PropertiesUtils.stringToProperties(action.getData()).getProperty("L4J_APPENDER");
    assertNotNull(oozieActionConfXml);
    assertNotNull(hadoopConfDir);
    String s = new File(oozieActionConfXml).getParent() + File.separator + "oozie-hadoop-conf-";
    Assert.assertTrue("Expected HADOOP_CONF_DIR to start with " + s + " but was " + hadoopConfDir, hadoopConfDir.startsWith(s));
    Assert.assertTrue("Expected YARN_CONF_DIR to start with " + s + " but was " + yarnConfDir, yarnConfDir.startsWith(s));
    Assert.assertEquals("Expected log4j.properties file to exist", "yes", log4jExists);
    Assert.assertTrue("Expected log4j.properties to have non-zero line count, but has: " + log4jFileLineCount, Integer.parseInt(log4jFileLineCount) > 0);
    Assert.assertEquals("Expected log4j.properties to have no container appender references (CLA/CLRA)", 0, Integer.parseInt(log4BadAppenderCount));
}

public void testInstrumentationTimer() throws Exception {
    MetricsInstrumentation inst = new MetricsInstrumentation();
    assertEquals(0, inst.getMetricRegistry().getTimers().size());
    Instrumentation.Cron cron1 = new Instrumentation.Cron();
    inst.addCron("a", "1", cron1);
    assertEquals(1, inst.getMetricRegistry().getTimers().size());
    Instrumentation.Cron cron2 = new Instrumentation.Cron();
    cron2.start();
    Thread.sleep(INTERVAL);
    cron2.stop();
    inst.addCron("a", "2", cron2);
    assertEquals(2, inst.getMetricRegistry().getTimers().size());
    Instrumentation.Cron cron3 = new Instrumentation.Cron();
    cron3.start();
    Thread.sleep(INTERVAL * 2);
    cron3.stop();
    inst.addCron("b", "1", cron3);
    assertEquals(3, inst.getMetricRegistry().getTimers().size());
    assertEquals(cron1.getOwn(), getTimerValue(inst.getMetricRegistry().getTimers().get("a.1.timer")));
    assertEquals(cron2.getOwn(), getTimerValue(inst.getMetricRegistry().getTimers().get("a.2.timer")));
    assertEquals(cron3.getOwn(), getTimerValue(inst.getMetricRegistry().getTimers().get("b.1.timer")));
}

public void testContentTypeWithAttachment() throws Exception {
    String file1 = "file1";
    Path path1 = new Path(getFsTestCaseDir(), file1);
    String content1 = "this is attachment content in file1";
    FileSystem fs = getFileSystem();
    Writer writer = new OutputStreamWriter(fs.create(path1, true), StandardCharsets.UTF_8);
    writer.write(content1);
    writer.close();
    sendAndReceiveEmail(path1.toString(), "text/html");
    Multipart retParts = (Multipart) (server.getReceivedMessages()[0].getContent());
    BodyPart bp = retParts.getBodyPart(0);
    assertTrue(bp.getContentType().contains("text/html"));
    assertEquals("This is a test mail", IOUtils.toString(bp.getInputStream()));
    sendAndReceiveEmail(path1.toString());
    retParts = (Multipart) (server.getReceivedMessages()[1].getContent());
    bp = retParts.getBodyPart(0);
    assertTrue(bp.getContentType().contains("text/plain"));
}

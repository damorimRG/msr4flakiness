@Test
public void testEventListener() throws Exception {
    EventHandlerService ehs = _testEventHandlerService();
    /*
         * Workflow Job events
         */
    WorkflowJobEvent event = new WorkflowJobEvent("jobid", "parentid", WorkflowJob.Status.RUNNING, getTestUser(), "myapp", null, null);
    ehs.queueEvent(event);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Job event STARTED"));
    output.setLength(0);
    event.setStatus(WorkflowJob.Status.SUSPENDED);
    ehs.queueEvent(event);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Job event SUSPEND"));
    output.setLength(0);
    event.setStatus(WorkflowJob.Status.SUCCEEDED);
    ehs.queueEvent(event);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Job event SUCCESS"));
    output.setLength(0);
    event.setStatus(WorkflowJob.Status.KILLED);
    ehs.queueEvent(event);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Job event FAILURE"));
    output.setLength(0);
    /*
         * Coordinator Action events
         */
    CoordinatorActionEvent event2 = new CoordinatorActionEvent("parentid@1", "parentid", CoordinatorAction.Status.WAITING, getTestUser(), "myapp", null, null, null);
    ehs.queueEvent(event2);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Coord Action event WAITING"));
    output.setLength(0);
    event2.setStatus(CoordinatorAction.Status.RUNNING);
    ehs.queueEvent(event2);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Coord Action event STARTED"));
    output.setLength(0);
    event2.setStatus(CoordinatorAction.Status.SUSPENDED);
    ehs.queueEvent(event2);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Coord Action event SUSPEND"));
    output.setLength(0);
    event2.setStatus(CoordinatorAction.Status.SUCCEEDED);
    ehs.queueEvent(event2);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Coord Action event SUCCESS"));
    output.setLength(0);
    event2.setStatus(CoordinatorAction.Status.TIMEDOUT);
    ehs.queueEvent(event2);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Coord Action event FAILURE"));
    output.setLength(0);
    event2.setStatus(CoordinatorAction.Status.KILLED);
    ehs.queueEvent(event2);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Coord Action event FAILURE"));
    output.setLength(0);
    /*
         * Workflow Action events
         */
    WorkflowActionEvent event3 = new WorkflowActionEvent("parentid@wfaction", "parentid", WorkflowAction.Status.RUNNING, getTestUser(), "myapp", null, null);
    ehs.queueEvent(event3);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Action event STARTED"));
    output.setLength(0);
    event3.setStatus(WorkflowAction.Status.START_MANUAL);
    ehs.queueEvent(event3);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Action event SUSPEND"));
    output.setLength(0);
    event3.setStatus(WorkflowAction.Status.OK);
    ehs.queueEvent(event3);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Action event SUCCESS"));
    output.setLength(0);
    event3.setStatus(WorkflowAction.Status.ERROR);
    ehs.queueEvent(event3);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Action event FAILURE"));
    output.setLength(0);
    event3.setStatus(WorkflowAction.Status.KILLED);
    ehs.queueEvent(event3);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Action event FAILURE"));
    output.setLength(0);
    event3.setStatus(WorkflowAction.Status.FAILED);
    ehs.queueEvent(event3);
    ehs.new EventWorker().run();
    assertTrue(output.toString().contains("Workflow Action event FAILURE"));
    output.setLength(0);
}

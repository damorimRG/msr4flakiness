/**
 * Test : purge bundle job and action still running
 *
 * @throws Exception if cannot insert records to the database
 */
public void testRunningBundle() throws Exception {
    BundleJobBean job = addRecordToBundleJobTable(Job.Status.RUNNING, DateUtils.parseDateOozieTZ("2011-01-01T01:00Z"));
    CoordinatorJobBean coordJob1 = addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING, false, false);
    coordJob1.setAppName("action1");
    CoordinatorJobBean coordJob2 = addRecordToCoordJobTable(CoordinatorJob.Status.SUCCEEDED, false, false);
    coordJob2.setAppName("action2");
    BundleActionBean bundleActionBean1 = addRecordToBundleActionTable(job.getId(), "action1", 0, Job.Status.RUNNING);
    BundleActionBean bundleActionBean2 = addRecordToBundleActionTable(job.getId(), "action2", 0, Job.Status.SUCCEEDED);
    purgeWithDefaultParameters();
    assertBundleJobNotPurged(job);
    assertBundleActionNotPurged(bundleActionBean1);
    assertBundleActionNotPurged(bundleActionBean2);
}

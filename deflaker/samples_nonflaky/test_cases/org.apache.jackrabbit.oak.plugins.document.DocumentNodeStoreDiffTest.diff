// OAK-2562
@Test
public void diff() throws Exception {
    DocumentNodeStore store = mk.getNodeStore();
    NodeBuilder builder = store.getRoot().builder();
    builder.child("other");
    for (int i = 0; i < 10; i++) {
        builder.child("test").child("folder").child("node-" + i);
    }
    merge(store, builder);
    for (int i = 0; i < 50; i++) {
        builder = store.getRoot().builder();
        builder.child("other").child("node-" + i);
        merge(store, builder);
    }
    NodeState before = store.getRoot();
    builder = store.getRoot().builder();
    builder.child("test").child("folder").child("node-x").child("child");
    NodeState after = merge(store, builder);
    for (int i = 0; i < 10; i++) {
        builder = store.getRoot().builder();
        builder.child("test").child("folder").child("node-" + i).child("child");
        merge(store, builder);
    }
    Iterable<CacheStats> stats = store.getDiffCacheStats();
    for (CacheStats cs : stats) {
        cs.resetStats();
    }
    // must not cause cache misses
    Diff.perform(before, after);
    for (CacheStats cs : stats) {
        assertEquals(0, cs.getMissCount());
    }
}

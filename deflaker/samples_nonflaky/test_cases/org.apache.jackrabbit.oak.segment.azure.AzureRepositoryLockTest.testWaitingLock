@Test
public void testWaitingLock() throws URISyntaxException, IOException, StorageException, InterruptedException {
    CloudBlockBlob blob = container.getBlockBlobReference("oak/repo.lock");
    Semaphore s = new Semaphore(0);
    new Thread(() -> {
        try {
            RepositoryLock lock = new AzureRepositoryLock(blob, () -> {
            }, 0).lock();
            s.release();
            Thread.sleep(1000);
            lock.unlock();
        } catch (Exception e) {
            log.error("Can't lock or unlock the repo", e);
        }
    }).start();
    s.acquire();
    new AzureRepositoryLock(blob, () -> {
    }, 10).lock();
}

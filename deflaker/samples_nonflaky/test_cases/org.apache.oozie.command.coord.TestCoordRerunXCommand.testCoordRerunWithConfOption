/**
 *  Passing config of workflow during rerun of coordinator.
 * @throws Exception
 */
public void testCoordRerunWithConfOption() throws Exception {
    Date start = DateUtils.parseDateOozieTZ("2009-02-01T01:00Z");
    Date end = DateUtils.parseDateOozieTZ("2009-02-01T23:59Z");
    CoordinatorJobBean coordJob = addRecordToCoordJobTable(CoordinatorJob.Status.RUNNING, start, end, false, false, 1);
    CoordinatorActionBean action = addRecordToWithLazyAction(coordJob.getId(), 1, CoordinatorAction.Status.SUBMITTED, "coord-rerun-action1.xml");
    final String actionId = action.getId();
    new CoordActionStartXCommand(actionId, getTestUser(), "myapp", "myjob").call();
    action = getCoordinatorAction(actionId);
    if (action.getStatus() == CoordinatorAction.Status.SUBMITTED) {
        fail("CoordActionStartCommand didn't work because the status for action id" + actionId + " is :" + action.getStatus() + " expected to be NOT SUBMITTED (i.e. RUNNING)");
    }
    final OozieClient coordClient = LocalOozie.getCoordClient();
    final OozieClient wclient = LocalOozie.getClient();
    waitFor(15 * 1000, new Predicate() {

        public boolean evaluate() throws Exception {
            return (coordClient.getCoordActionInfo(actionId).getStatus() == CoordinatorAction.Status.RUNNING);
        }
    });
    wclient.kill(coordClient.getCoordActionInfo(actionId).getExternalId());
    waitFor(150 * 1000, new Predicate() {

        public boolean evaluate() throws Exception {
            return (coordClient.getCoordActionInfo(actionId).getStatus() == CoordinatorAction.Status.KILLED);
        }
    });
    Properties prop = new Properties();
    // Passing props to coordinator which will be passed to workflow rerun as well.
    prop.setProperty("workflowConf", "foo");
    coordClient.reRunCoord(coordJob.getId(), RestConstants.JOB_COORD_SCOPE_ACTION, "1", false, true, true, prop);
    waitFor(150 * 1000, new Predicate() {

        public boolean evaluate() throws Exception {
            return (coordClient.getCoordActionInfo(actionId).getStatus() == CoordinatorAction.Status.SUCCEEDED);
        }
    });
    WorkflowJob wfJob = wclient.getJobInfo(coordClient.getCoordActionInfo(actionId).getExternalId());
    Configuration conf = new XConfiguration(new StringReader(wfJob.getConf()));
    assertEquals(prop.get("workflowConf"), conf.get("workflowConf"));
}

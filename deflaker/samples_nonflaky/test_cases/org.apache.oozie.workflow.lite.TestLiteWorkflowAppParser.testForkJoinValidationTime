@SuppressWarnings("deprecation")
public void testForkJoinValidationTime() throws Exception {
    final LiteWorkflowAppParser parser = newLiteWorkflowAppParser();
    final LiteWorkflowApp app = parser.validateAndParse(IOUtils.getResourceAsReader("wf-long.xml", -1), new Configuration());
    final AtomicBoolean failure = new AtomicBoolean(false);
    final AtomicBoolean finished = new AtomicBoolean(false);
    Runnable r = new Runnable() {

        @Override
        public void run() {
            try {
                invokeForkJoin(parser, app);
                finished.set(true);
            } catch (Exception e) {
                e.printStackTrace();
                failure.set(true);
            }
        }
    };
    Thread t = new Thread(r);
    t.start();
    t.join((long) (2000 * XTestCase.WAITFOR_RATIO));
    if (!finished.get()) {
        // don't let the validation keep running in the background which causes high CPU load
        t.stop();
        fail("Workflow validation did not finish in time");
    }
    assertFalse("Workflow validation failed", failure.get());
}

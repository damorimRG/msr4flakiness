@Test
public void completeResult() throws Exception {
    final int NUM_DOCS = 200;
    // populate the store
    List<UpdateOp> ops = Lists.newArrayList();
    for (int i = 0; i < NUM_DOCS; i++) {
        UpdateOp op = new UpdateOp(getIdFromPath("/node-" + i), true);
        NodeDocument.setModified(op, new Revision(i * 5000, 0, 1));
        ops.add(op);
    }
    assertTrue(store.create(NODES, ops));
    Set<String> ids = Sets.newHashSet();
    boolean updated = false;
    MissingLastRevSeeker seeker = builder.createMissingLastRevSeeker();
    for (NodeDocument doc : seeker.getCandidates(0)) {
        if (!updated) {
            // as soon as we have the first document, update /node-0
            UpdateOp op = new UpdateOp(getIdFromPath("/node-0"), false);
            // and push out the _modified timestamp
            NodeDocument.setModified(op, new Revision(NUM_DOCS * 5000, 0, 1));
            // even after the update the document matches the query
            assertNotNull(store.findAndUpdate(NODES, op));
            updated = true;
        }
        if (doc.getPath().toString().startsWith("/node-")) {
            ids.add(doc.getId());
        }
    }
    // seeker must return all documents
    assertEquals(NUM_DOCS, ids.size());
}

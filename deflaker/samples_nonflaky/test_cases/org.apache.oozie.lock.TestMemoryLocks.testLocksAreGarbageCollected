public void testLocksAreGarbageCollected() throws ServiceException, InterruptedException {
    String path = new String("a");
    String path1 = new String("a");
    MemoryLocksService lockService = new MemoryLocksService();
    lockService.init(Services.get());
    LockToken lock = lockService.getWriteLock(path, DEFAULT_LOCK_TIMEOUT);
    int oldHash = lockService.getMemoryLocks().getLockMap().get(path).hashCode();
    lock.release();
    lock = lockService.getWriteLock(path1, DEFAULT_LOCK_TIMEOUT);
    int newHash = lockService.getMemoryLocks().getLockMap().get(path1).hashCode();
    assertTrue(oldHash == newHash);
    lock.release();
    lock = null;
    System.gc();
    path = "a";
    lock = lockService.getWriteLock(path, DEFAULT_LOCK_TIMEOUT);
    newHash = lockService.getMemoryLocks().getLockMap().get(path).hashCode();
    assertFalse(oldHash == newHash);
}

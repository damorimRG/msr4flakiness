public void testHDFSFileAttachment() throws Exception {
    String file1 = "file1";
    Path path1 = new Path(getFsTestCaseDir(), file1);
    String content1 = "this is attachment content in file1";
    String file2 = "file2";
    Path path2 = new Path(getFsTestCaseDir(), file2);
    String content2 = "this is attachment content in file2";
    FileSystem fs = getFileSystem();
    Writer writer = new OutputStreamWriter(fs.create(path1, true), StandardCharsets.UTF_8);
    writer.write(content1);
    writer.close();
    writer = new OutputStreamWriter(fs.create(path2, true), StandardCharsets.UTF_8);
    writer.write(content2);
    writer.close();
    StringBuilder tag = new StringBuilder();
    tag.append(path1.toString()).append(",").append(path2.toString());
    assertAttachment(tag.toString(), 2, content1, content2);
    // test case when email attachment support set to false
    ConfigurationService.setBoolean(EmailActionExecutor.EMAIL_ATTACHMENT_ENABLED, false);
    sendAndReceiveEmail(tag.toString());
    MimeMessage retMeg = server.getReceivedMessages()[1];
    String msgBody = GreenMailUtil.getBody(retMeg);
    assertEquals(msgBody.indexOf("This is a test mail"), 0);
    assertNotSame(msgBody.indexOf(EmailActionExecutor.EMAIL_ATTACHMENT_ERROR_MSG), -1);
    // email content is not multi-part since not attaching files
    assertFalse(retMeg.getContent() instanceof Multipart);
    assertTrue(retMeg.getContentType().contains("text/plain"));
}

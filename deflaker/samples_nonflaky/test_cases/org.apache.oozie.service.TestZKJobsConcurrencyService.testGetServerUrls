public void testGetServerUrls() throws Exception {
    ZKJobsConcurrencyService zkjcs = new ZKJobsConcurrencyService();
    // We'll use some DummyZKXOozies here to pretend to be other Oozie servers that will influence getServerUrls()
    // once they are running in that the there will be other Oozie "server" urls to return
    DummyZKOozie dummyOozie = null;
    DummyZKOozie dummyOozie2 = null;
    try {
        zkjcs.init(Services.get());
        Map<String, String> map = zkjcs.getServerUrls();
        assertEquals(1, map.size());
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals(ConfigUtils.getOozieURL(false), map.get(ZK_ID));
        dummyOozie = new DummyZKOozie("0000", "http://blah1");
        map = zkjcs.getServerUrls();
        assertEquals(2, map.size());
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals(ConfigUtils.getOozieURL(false), map.get(ZK_ID));
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals("http://blah1", map.get("0000"));
        dummyOozie2 = new DummyZKOozie("z", "http://blah2");
        map = zkjcs.getServerUrls();
        assertEquals(3, map.size());
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals(ConfigUtils.getOozieURL(false), map.get(ZK_ID));
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals("http://blah1", map.get("0000"));
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals("http://blah2", map.get("z"));
        dummyOozie.teardown();
        map = zkjcs.getServerUrls();
        assertEquals(2, map.size());
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals(ConfigUtils.getOozieURL(false), map.get(ZK_ID));
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals("http://blah2", map.get("z"));
        dummyOozie2.teardown();
        map = zkjcs.getServerUrls();
        assertEquals(1, map.size());
        assertEquals(ZK_ID, map.keySet().iterator().next());
        assertEquals(ConfigUtils.getOozieURL(false), map.get(ZK_ID));
    } finally {
        zkjcs.destroy();
        if (dummyOozie != null) {
            dummyOozie.teardown();
        }
        if (dummyOozie2 != null) {
            dummyOozie2.teardown();
        }
    }
}

public void testWFXmlGeneration() throws Exception {
    Configuration conf = new Configuration();
    conf.set(XOozieClient.RM, "jobtracker");
    conf.set(XOozieClient.NN, "namenode");
    conf.set(OozieClient.LIBPATH, "libpath");
    conf.set(XOozieClient.SQOOP_COMMAND, "import\n--connect\njdbc:mysql://localhost:3306/oozie");
    String sqoopArgsStr = "-Da=aaa -Db=bbb";
    String[] args = sqoopArgsStr.split(" ");
    ActionUtils.setStrings(conf, XOozieClient.SQOOP_OPTIONS, args);
    SubmitSqoopXCommand submitSqoopCmd = new SubmitSqoopXCommand(conf);
    String xml = submitSqoopCmd.getWorkflowXml(conf);
    XLog.getLog(getClass()).info("xml = " + xml);
    StringBuilder sb = new StringBuilder();
    sb.append("<workflow-app xmlns=\"uri:oozie:workflow:0.2\" name=\"oozie-sqoop\">");
    sb.append("<start to=\"sqoop1\" />");
    sb.append("<action name=\"sqoop1\">");
    sb.append("<sqoop xmlns=\"uri:oozie:sqoop-action:0.4\">");
    sb.append("<job-tracker>jobtracker</job-tracker>");
    sb.append("<name-node>namenode</name-node>");
    sb.append("<configuration>");
    sb.append("<property>");
    sb.append("<name>a</name>");
    sb.append("<value>aaa</value>");
    sb.append("</property>");
    sb.append("<property>");
    sb.append("<name>b</name>");
    sb.append("<value>bbb</value>");
    sb.append("</property>");
    sb.append("</configuration>");
    sb.append("<arg>import</arg>");
    sb.append("<arg>--connect</arg>");
    sb.append("<arg>jdbc:mysql://localhost:3306/oozie</arg>");
    sb.append("</sqoop>");
    sb.append("<ok to=\"end\" />");
    sb.append("<error to=\"fail\" />");
    sb.append("</action>");
    sb.append("<kill name=\"fail\">");
    sb.append("<message>sqoop failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>");
    sb.append("</kill>");
    sb.append("<end name=\"end\" />");
    sb.append("</workflow-app>");
    Element root = XmlUtils.parseXml(sb.toString());
    String reference = XmlUtils.prettyPrint(root).toString();
    XLog.getLog(getClass()).info("reference xml = " + reference);
    assertTrue(xml.equals(reference));
}

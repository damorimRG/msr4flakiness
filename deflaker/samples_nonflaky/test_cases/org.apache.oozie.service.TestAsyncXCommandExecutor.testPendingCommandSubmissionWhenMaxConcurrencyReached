@Test
public void testPendingCommandSubmissionWhenMaxConcurrencyReached() {
    XCallable<?> callable = mock(XCallable.class);
    when(callable.getType()).thenReturn(DEFAULT_TYPE);
    Mockito.<XCallable<?>>when(callableWrapper.getElement()).thenReturn(callable);
    when(callableQueueService.canSubmitCallable(eq(callable))).thenReturn(false);
    asyncExecutor.handleConcurrencyExceeded(callableWrapper);
    asyncExecutor.checkMaxConcurrency(DEFAULT_TYPE);
    verifyZeroInteractions(executor);
    assertEquals("Number of pending commands", 1, pendingCommandsPerType.size());
    Set<CallableWrapper<?>> pendingCommandsList = pendingCommandsPerType.get(DEFAULT_TYPE);
    assertNotNull("List of pending commands doesn't exist", pendingCommandsList);
    assertEquals("List of pending commands list should not be empty", 1, pendingCommandsList.size());
}

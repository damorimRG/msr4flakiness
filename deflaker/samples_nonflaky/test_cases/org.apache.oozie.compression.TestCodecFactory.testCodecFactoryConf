@Test
public void testCodecFactoryConf() throws Exception {
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    DataOutputStream daos = new DataOutputStream(baos);
    // magic data
    daos.write(CodecFactory.COMPRESSION_MAGIC_DATA.getBytes(CodecFactory.UTF_8_ENCODING));
    // version
    daos.writeInt(1);
    // no of key value pairs
    daos.writeInt(1);
    daos.writeUTF(CodecFactory.COMPRESSION_KEY_HEADER);
    daos.writeUTF(GzipCompressionCodec.CODEC_NAME);
    daos.close();
    assertEquals(new String(baos.toByteArray(), StandardCharsets.UTF_8), new String(CodecFactory.getHeaderBytes(), StandardCharsets.UTF_8));
    Configuration conf = services.getConf();
    conf.set(CodecFactory.COMPRESSION_OUTPUT_CODEC, "none");
    CodecFactory.initialize(conf);
    assertTrue(!CodecFactory.isCompressionEnabled());
    conf.set(CodecFactory.COMPRESSION_OUTPUT_CODEC, "");
    CodecFactory.initialize(conf);
    assertTrue(!CodecFactory.isCompressionEnabled());
    conf.set(CodecFactory.COMPRESSION_CODECS, "gz=" + GzipCompressionCodec.class.getName());
    CodecFactory.initialize(conf);
    conf.set(CodecFactory.COMPRESSION_OUTPUT_CODEC, "abcd");
    try {
        CodecFactory.initialize(conf);
    } catch (Exception e) {
    // expected
    }
}

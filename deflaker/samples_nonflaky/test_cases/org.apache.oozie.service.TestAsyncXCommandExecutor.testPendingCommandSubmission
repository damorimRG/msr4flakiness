@Test
public void testPendingCommandSubmission() {
    XCallable<?> callable = mock(XCallable.class);
    when(callable.getType()).thenReturn(DEFAULT_TYPE);
    Mockito.<XCallable<?>>when(callableWrapper.getElement()).thenReturn(callable);
    when(callableQueueService.canSubmitCallable(eq(callable))).thenReturn(true);
    asyncExecutor.handleConcurrencyExceeded(callableWrapper);
    asyncExecutor.checkMaxConcurrency(DEFAULT_TYPE);
    verify(executor).execute(eq(callableWrapper));
    assertEquals("Number of pending commands", 1, pendingCommandsPerType.size());
    Set<CallableWrapper<?>> pendingCommandsList = pendingCommandsPerType.get(DEFAULT_TYPE);
    assertNotNull("List of pending commands doesn't exist", pendingCommandsList);
    assertEquals("List of pending commands should be empty", 0, pendingCommandsList.size());
}

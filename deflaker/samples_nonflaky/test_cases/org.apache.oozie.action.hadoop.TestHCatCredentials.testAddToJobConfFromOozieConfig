@Test
public void testAddToJobConfFromOozieConfig() throws Exception {
    services.init();
    HCatCredentialHelper hcatCredHelper = Mockito.mock(HCatCredentialHelper.class);
    PowerMockito.whenNew(HCatCredentialHelper.class).withNoArguments().thenReturn(hcatCredHelper);
    CredentialsProperties credProps = new CredentialsProperties("", "");
    HashMap<String, String> prop = new HashMap<String, String>();
    prop.put("hcat.metastore.principal", TEST_HIVE_METASTORE_PRINCIPAL2);
    prop.put("hcat.metastore.uri", TEST_HIVE_METASTORE_URI2);
    credProps.setProperties(prop);
    HCatCredentials hcatCred = new HCatCredentials();
    final JobConf jobConf = new JobConf(false);
    Credentials credentials = new Credentials();
    PowerMockito.doAnswer(new Answer<Void>() {

        @Override
        public Void answer(InvocationOnMock invocation) throws Throwable {
            Object[] args = invocation.getArguments();
            JobConf jConf = (JobConf) args[1];
            jConf.set(HCAT_METASTORE_PRINCIPAL, (String) args[2]);
            jConf.set(HCAT_METASTORE_URI, (String) args[3]);
            return null;
        }
    }).when(hcatCredHelper).set(credentials, jobConf, TEST_HIVE_METASTORE_PRINCIPAL2, TEST_HIVE_METASTORE_URI2);
    hcatCred.updateCredentials(credentials, jobConf, credProps, null);
    assertEquals(TEST_HIVE_METASTORE_PRINCIPAL2, jobConf.get(HCAT_METASTORE_PRINCIPAL));
    assertEquals(TEST_HIVE_METASTORE_URI2, jobConf.get(HCAT_METASTORE_URI));
    assertNull(jobConf.get(HIVE_METASTORE_PRINCIPAL));
    assertNull(jobConf.get(HIVE_METASTORE_URI));
}

@Test
public void testAddToJobConfFromHiveConf() throws Exception {
    services.init();
    CredentialsProperties credProps = new CredentialsProperties("", "");
    credProps.setProperties(new HashMap<String, String>());
    HCatCredentials hcatCred = new HCatCredentials();
    final JobConf jobConf = new JobConf(false);
    Credentials credentials = new Credentials();
    HCatCredentialHelper hcatCredHelper = Mockito.mock(HCatCredentialHelper.class);
    PowerMockito.whenNew(HCatCredentialHelper.class).withNoArguments().thenReturn(hcatCredHelper);
    PowerMockito.doAnswer(new Answer<Void>() {

        @Override
        public Void answer(InvocationOnMock invocation) throws Throwable {
            Object[] args = invocation.getArguments();
            Configuration jConf = (Configuration) args[1];
            jConf.set(HIVE_METASTORE_PRINCIPAL, (String) args[2]);
            jConf.set(HIVE_METASTORE_URI, (String) args[3]);
            return null;
        }
    }).when(hcatCredHelper).set(credentials, jobConf, TEST_HIVE_METASTORE_PRINCIPAL, TEST_HIVE_METASTORE_URI);
    hcatCred.updateCredentials(credentials, jobConf, credProps, null);
    assertEquals(TEST_HIVE_METASTORE_PRINCIPAL, jobConf.get(HIVE_METASTORE_PRINCIPAL));
    assertEquals(TEST_HIVE_METASTORE_URI, jobConf.get(HIVE_METASTORE_URI));
    assertNull(jobConf.get(HCAT_METASTORE_PRINCIPAL));
    assertNull(jobConf.get(HCAT_METASTORE_URI));
}
